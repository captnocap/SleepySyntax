(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9916],{2451:(e,a,t)=>{"use strict";t.d(a,{ChatClientPage:()=>D});var s=t(54568),n=t(7726),l=t(91961),i=t(95675),r=t(56273),o=t(1761),u=t(53248);function d(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e.length<=a)return e;let t=Math.ceil(a/2);return"".concat(e.substring(0,t),"\n\n  [...]\n\n  ").concat(e.substring(e.length-t))}var c=t(7620),m=t(46760),v=t(70011),f=t(19303),p=t(2341),g=t(1974),_=t(62942),h=t(22522),y=t(20298),x=t(98518),j=t(99965),w=t(92947),k=t(28871),S=t(8027),A=t(11515),C=t(41417),N=t(37076),b=t(98411),E=t(62971),M=t(94748),I=t(13625),O=t(67532);function F(e){let{isModalOpen:a,currentTool:t,currentToolInput:n,currentServer:l,handleDeny:i,handleAllow:r,handleAlwaysAllow:o}=e,{isExpanded:u,setIsExpanded:d,snappyTransition:c}=(0,O.a)(!1);if(t)return(0,s.jsxs)(N.aF,{isOpen:a,onClose:()=>i(),autoCloseOnFocusOut:!1,closeOnEscapeKeydown:!1,modalSize:"lg",title:(0,s.jsx)(E.A,{defaultMessage:"Claude would like to use this tool",id:"PwE/s/W1AC"}),children:[(0,s.jsx)("div",{className:"mt-4"}),(0,s.jsx)(M.sH,{isStreaming:!1,isExpanded:u,setIsExpanded:d,isFirstBlockOfMessage:!0,isLastBlockOfMessage:!0,text:(0,s.jsx)(b.fI,{className:"!py-0",children:(0,s.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,s.jsx)(A.d,{url:null==l?void 0:l.url,fallbackSvg:(0,s.jsx)(S.B,{letter:t.serverName,size:40}),size:40}),(0,s.jsxs)("div",{className:"flex flex-col py-1",children:[(0,s.jsx)("div",{className:"text-sm text-text-400 font-mono",children:t.name}),(0,s.jsx)("span",{className:"font-medium text-[0.9rem] pt-1",children:t.serverName})]})]})}),className:"!h-auto",children:(0,s.jsx)(M.NG,{isExpanded:u,snappyTransition:c,isScrollable:!0,children:(0,s.jsx)(I.L,{input:n?JSON.parse(n):""})})}),(0,s.jsxs)("div",{className:"flex flex-col p-4 gap-4 bg-bg-300 my-4 rounded-lg border-0.5 border-border-300",children:[(0,s.jsx)("p",{className:"font-medium",children:(0,s.jsx)(E.A,{defaultMessage:"Review each action carefully before approving",id:"IaQzFuy2mt"})}),(0,s.jsx)("p",{children:(0,s.jsx)(E.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})]}),(0,s.jsx)(N.vW,{className:"flex justify-between",children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[o&&(0,s.jsx)(C.$,{onClick:o,children:(0,s.jsx)(E.A,{defaultMessage:"Allow always",id:"F8zkKBCp6U"})}),(0,s.jsx)(C.$,{onClick:r,autoFocus:!0,children:(0,s.jsx)(E.A,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})})]}),(0,s.jsx)(C.$,{onClick:i,variant:"outline",children:(0,s.jsx)(E.A,{defaultMessage:"Decline",id:"pvtgR26QWY"})})]})})]})}function T(e){var a,t;let{conversation:l,conversationUUID:i,chatInputDefaultMessage:r}=e,{currentPath:S,data:A,isLoading:C,isPlaceholderData:N}=(0,n.Bq)(i,{suppressError:!0}),{changeDisplayedConversationPath:b}=(0,f.G)(),{onInvokeTool:E,isModalOpen:M,currentTool:I,currentToolInput:O,currentServer:T,handleAllow:z,handleDeny:D,handleAlwaysAllow:P}=function(e){let{conversationUUID:a}=e,{mcpTools:t,servers:s}=(0,w.gt)(),n=(0,y.M)(),{track:l}=(0,x.st)(),[i,r]=(0,c.useState)(!1),[o,u]=(0,c.useState)(null),[d,m]=(0,c.useState)(null),[v,f]=(0,c.useState)(null),[p,g]=(0,c.useState)(null),[_,h]=(0,c.useState)(void 0),[S,A]=(0,c.useState)(void 0),C=(0,j.p9)(),N=(0,w.HJ)(),b=(0,w.Ib)(),{toggleMcpToolAlwaysApproved:E}=(0,w.es)(),{getApprovalSetting:M}=(0,w.BN)(),{alwaysAllowEnabled:I}=M(null==o?void 0:o.serverName,o),{mutate:O}=(0,j.p4)(a),F=(0,c.useRef)(b);(0,c.useEffect)(()=>{F.current=b},[b]);let T=(0,c.useCallback)(async(e,a,l,i,o,d,c)=>{var v;if(N)return;let p=a.includes(":"),_=[...t,...c?s.flatMap(e=>e.tools):[]].find(e=>(p?"".concat(e.serverName,":").concat(e.name):e.name)===a),y=(null==(v=s.find(e=>{let{name:a}=e;return a===(null==_?void 0:_.serverName)}))?void 0:v.uuid)||"local";if(!_||!y)return n(e,a,l,i,o);if(C&&!y.startsWith("local:"))return d?new Promise(e=>{m(y),u(_),f(l),g(i),h(d),A(c),r(!0),e()}):void 0;let{approvalSetting:x}=M(_.serverName,_);return"never"===x||F.current.includes(_.alwaysApprovedKey)?n(e,a,l,i,o):new Promise(e=>{m(y),u(_),f(l),g(i),r(!0),e()})},[s,n,t,M,C,N]),z=(0,c.useCallback)(()=>{r(!1),o&&null!==v&&null!==p&&(_&&S?O({tool_use_id:v,is_approved:!0}):n(a,"".concat(o.serverName,":").concat(o.name),v,p))},[a,o,v,p,n,_,S,O]),D=(0,c.useCallback)(()=>{if(r(!1),o&&null!==v&&null!==p)if(_&&S)O({tool_use_id:v,is_approved:!1});else{var e;n(a,"".concat(o.serverName,":").concat(o.name),v,p,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),l({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!=(e=(0,k.p)(p))?e:{}).length})}},[a,o,v,p,n,l,_,S,O]),P=(0,c.useCallback)(()=>{(_?_.includes("always"):I)&&(o&&!S&&E(o.alwaysApprovedKey,!0),r(!1),o&&null!==v&&null!==p&&(_&&S&&O({tool_use_id:v,is_approved:!0,approval_key:S,approval_option:"always"}),n(a,"".concat(o.serverName,":").concat(o.name),v,p)))},[a,o,v,p,n,E,I,_,S,O]);return{onInvokeTool:T,isModalOpen:i,currentTool:o,currentServer:s.find(e=>e.uuid===d),currentToolInput:p,handleAllow:z,handleDeny:D,handleAlwaysAllow:I?P:void 0}}({conversationUUID:i}),R=(0,v.Z3)(i),U=(0,y.n)(null==A?void 0:A.settings,null==l?void 0:l.project_uuid),{markFirstTokenReceived:B}=(0,g.B)(),L=(0,c.useCallback)(()=>{B({model:R})},[B,R]),[K,Y]=(0,c.useState)(),q=(0,c.useCallback)(e=>{Y(e)},[Y]),Q=(0,v.Gw)(i,E,U,L),V=(0,v.SL)(i,E,U,K,L),{mutate:W}=(0,n.lj)(i),X=Q.isStreaming||V.isStreaming,G=Q.runStream;!function(e,a){let[t,s]=(0,c.useState)(!1),{activeOrganization:l}=(0,o.YL)(),i=(0,m.A)(),r=e?e.uuid:"",{mutate:v}=(0,n.HI)(r),{mutate:f,error:p}=(0,n.OZ)(r),g=(0,c.useRef)(!1);(0,c.useEffect)(()=>{var a;if(!p||(null==e?void 0:e.name))return;let t=(null==e||null==(a=e.chat_messages)?void 0:a[0])?(0,u.C)(e.chat_messages[0]):"";if(t){if(g.current)return;let e=t.slice(0,30),a=t.length>30?"...":"";g.current=!0,v({name:"".concat(e).concat(a)})}},[p,e,v]),(0,c.useEffect)(()=>{if(a||t||(null==e?void 0:e.name))return;let n=null==e?void 0:e.chat_messages;if(!n||n.length<2||0===(0,u.C)(n[1]).length)return;let i=["Message 1:",d((0,u.C)(n[0])),"Message 2:",d((0,u.C)(n[1]))].join("\n\n");l&&(s(!0),f({message_content:i,recent_titles:[]}))},[a,t,e,l,f,i])}(A,X);let H=(0,c.useCallback)(async(e,a)=>{var t,s;await G({prompt:a,attachments:e.attachments,files:null!=(s=e.files_v2)?s:e.files,syncSources:e.sync_sources,parent_message_uuid:e.parent_message_uuid,personalized_style:K,compass_mode:null==(t=e.metadata)?void 0:t.compass_mode})},[G,K]),Z=(0,c.useCallback)((e,a)=>{b(i,e,a,e=>W({current_leaf_message_uuid:e}))},[b,i,W]);return A||C||N||(0,_.notFound)(),(0,s.jsxs)(p.N,{settings:(null==A?void 0:A.settings)||{},children:[(0,s.jsx)(h.v,{isStreaming:X,isTemporary:!!(null==l?void 0:l.is_temporary),chatInputDefaultMessage:r,conversationTitle:l?"".concat(l.name," - Claude"):"Claude",conversationUUID:i,isLoading:C,messages:S,name:null!=(t=null!=(a=null==A?void 0:A.name)?a:null==l?void 0:l.name)?t:"Untitled Chat",onSend:Q.runStream,onRetry:V.runStream,projectUuid:null==A?void 0:A.project_uuid,changeDisplayedConversationPath:Z,editMessage:H,setPersonalizedStyleCallback:q,onToolAllow:z}),(0,s.jsx)(F,{isModalOpen:M,currentTool:I,currentToolInput:O,currentServer:T,handleDeny:D,handleAllow:z,handleAlwaysAllow:P})]})}var z=t(55947);function D(e){var a;let{uuid:t,q:o}=e,{data:u}=(0,n.Bq)(t);return(0,l.K7)(null!=(a=null==u?void 0:u.name)?a:""),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.u,{conversationUUID:t,children:(0,s.jsx)(i._,{conversationUUID:t,children:(0,s.jsx)(T,{conversation:u,conversationUUID:t,chatInputDefaultMessage:o})})}),(0,s.jsx)(z.T,{})]})}},28137:(e,a,t)=>{"use strict";t.d(a,{F:()=>u});var s=t(98518),n=t(1761),l=t(27062),i=t(7620),r=t(34116);let o="payment-verification-reminder-dismissed";function u(){let{activeOrganization:e}=(0,n.YL)(),a=(0,s.st)(),[t,u]=(0,i.useState)(!1),{value:d}=(0,l.fS)("show_3ds_modal"),{data:c}=(0,r.PI)(d);return(0,i.useEffect)(()=>{var t;let s=localStorage.getItem(o);if(s){let e=new Date(s).getTime();if(new Date().getTime()-e<864e5)return void u(!1)}let n=d&&null!=(t=null==c?void 0:c.requires_3ds_verification)&&t;u(n),n&&a.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,modal_type:"3ds_verification_required"})},[d,c,a,e]),{shouldShowModal:t,dismissReminder:(0,i.useCallback)(()=>{let t=new Date().toISOString();localStorage.setItem(o,t),u(!1),a.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,action:"3ds_verification_dismissed",dismissed_at:t})},[a,e])}}},55947:(e,a,t)=>{"use strict";t.d(a,{T:()=>p});var s=t(54568),n=t(98518),l=t(1761),i=t(51121),r=t(78730),o=t(86030),u=t(37076),d=t(87606),c=t(7620),m=t(62971),v=t(34116),f=t(28137);function p(){let[e,a]=(0,c.useState)(!1),t=(0,n.st)(),{activeOrganization:p}=(0,l.YL)(),{addError:g,addSuccess:_}=(0,i.Y)(),h=(0,r.ib)(),y=(0,d.useQueryClient)(),{shouldShowModal:x,dismissReminder:j}=(0,f.F)(),w=(0,v.Si)({onSuccess:async e=>{try{let a=await h;if(!a)throw Error("Stripe failed to initialize");let n=await a.handleNextAction({clientSecret:e.clientSecret});if(n.error)throw Error(n.error.message||"PAYMENT_VERIFICATION_FAILED");await y.invalidateQueries({queryKey:["check-3ds-required",null==p?void 0:p.uuid]}),_((0,s.jsx)(m.A,{defaultMessage:"Payment method verified successfully",id:"vRXoCh/o7W"})),t.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_success"})}catch(e){g(e instanceof Error&&"PAYMENT_VERIFICATION_FAILED"===e.message?(0,s.jsx)(m.A,{defaultMessage:"Payment verification failed",id:"9RpX03Q2ky"}):e instanceof Error?e.message:(0,s.jsx)(m.A,{defaultMessage:"Payment verification failed. Please try again.",id:"0kXa3Rf5bZ"})),t.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_error",error_message:e instanceof Error?e.message:"Unknown error"})}finally{a(!1)}},onError:e=>{a(!1),g((0,s.jsx)(m.A,{defaultMessage:"Failed to start verification process. Please try again.",id:"3dT/r8rV5S"})),t.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_api_error",error_message:e.message})}}),k=()=>{j()};return x?(0,s.jsx)(u.aF,{isOpen:x,onClose:k,modalSize:"md",hasCloseButton:!0,title:(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)(o.E,{color:"secondary",size:"lg",children:(0,s.jsx)(m.A,{defaultMessage:"Action Required",id:"jWgFDt2Ifa"})})}),children:(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h2",{className:"text-3xl font-medium text-text-100 mb-3",children:(0,s.jsx)(m.A,{defaultMessage:"Verify your payment method",id:"epYApo9bIj"})}),(0,s.jsx)("p",{className:"text-text-200 mb-6",children:(0,s.jsx)(m.A,{defaultMessage:"To comply with European security regulations, we need to verify your payment method using a quick one-time security process. This ensures your subscription remains active and secure.",id:"K0hDpiUx0B"})}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 mt-6",children:[(0,s.jsx)(u.yl,{onClick:()=>{a(!0),t.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_start"});let e=window.location.href;w.mutate({return_url:e})},loading:e,className:"w-full",children:(0,s.jsx)(m.A,{defaultMessage:"Verify now",id:"t28SE7zKVA"})}),(0,s.jsx)(u.yl,{variant:"secondary",onClick:k,className:"w-full",children:(0,s.jsx)(m.A,{defaultMessage:"Remind me later",id:"c4hRLOnYpQ"})})]})]})}):null}},68708:(e,a,t)=>{Promise.resolve().then(t.bind(t,2451))}},e=>{e.O(0,[1658,3473,7598,2971,7261,2846,5006,1036,9474,5015,7773,6625,7463,8887,8132,5647,6631,2814,3103,1773,8864,4783,6320,3491,497,9413,9860,4478,3070,3244,7049,9501,45,3904,1570,5915,9771,8378,1761,8518,4573,8896,4116,11,7383,28,2947,9946,2693,8211,6147,953,7143,4384,8605,1168,3565,4966,7124,2522,587,842,3074,7358],()=>e(e.s=68708)),_N_E=e.O()}]);